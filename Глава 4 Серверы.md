**Глава 4: Серверы** 

**4.1. Основы** 

Серверы отличаются от рабочих станций тем, что они обслуживают множество пользователей, поэтому их надежность и бесперебойная работа являются приоритетом. Серверы рассчитаны на более продолжительное время работы и требуют дополнительных затрат, но покупка сервера с избыточной мощностью становится вложением в продление его срока службы. К серверу могут подключаться сотни, тысячи или даже миллионы пользователей, что создает дополнительные требования к производительности и надежности. 

1. **Покупайте для серверов серверное оборудование** 

Серверное оборудование отличается от клиентских систем и настольных рабочих станций. Попытки сэкономить за счет покупки настольного компьютера и установки на него серверного ПО могут быть краткосрочным решением, но не подходят для долгосрочных проектов. Серверное оборудование обычно дороже, но дополнительные возможности оправдывают вложения: 

- **Расширяемость**: Больше места для жестких дисков, слотов для карт расширения и процессоров. Поставщики предоставляют дополнительные конфигурации для кластеризации, распределения нагрузки и автоматизации переключения на резервные мощности. 
- **Производительность процессоров**: Серверы часто оборудованы несколькими ЦП и дополнительными возможностями для повышения производительности, такими как упреждающая выборка данных и динамическое распределение ресурсов между ЦП. Процессоры различаются частотами, на которых работают, и их цена зависит от частоты. Наиболее скоростные ЦП обычно дороже, но такие расходы могут быть оправданы на сервере, который поддерживает множество пользователей. 
- **Высокопроизводительные системы ввода-вывода**: Использование скоростных подсистем ввода-вывода, таких как SCSI или FC-AL, высокоскоростных внутренних шин и сетевых интерфейсов. Возможности ввода-вывода часто пропорциональны количеству пользователей, что оправдывает применение скоростных подсистем. 
- **Возможности модернизации**: Возможность добавлять или заменять процессоры без дополнительных аппаратных изменений. Серверные процессоры размещаются на отдельных разъемах в шасси или съемных разъемах на системной плате. 
- **Монтирование в стойку**: Серверы должны быть сконструированы для установки в стойки, что обеспечивает эффективное использование пространства и охлаждение. Все крышки должны сниматься без необходимости извлечения сервера из стойки. Серверы должны быть прямоугольной формы для 

  эффективного использования пространства в стойке, а вентиляционные отверстия должны быть расположены так, чтобы обеспечивать сквозную вентиляцию от передней панели к задней. 

- **Дополнения для повышенной надежности**: Дублированные источники питания, RAID, несколько сетевых карт и компоненты с поддержкой "горячей" замены. Эти возможности повышают надежность серверов и уменьшают время простоя. 
- **Контракт на обслуживание**: Поставщики предоставляют контракты на обслуживание оборудования, где оговариваются гарантийные сроки замены запасных частей. Это обеспечивает дополнительную поддержку и уверенность в надежности оборудования. 
- **Альтернативные варианты управления**: Поддержка функций удаленного управления, таких как доступ через последовательный порт и встроенные датчики температуры. Эти функции позволяют проводить диагностику и решать проблемы удаленно, что особенно важно для серверов в колокейшн-центрах. 
2. **Выбирайте поставщиков, известных надежностью продукции** 

Важно выбирать поставщиков, продукция которых известна своей надежностью. Некоторые поставщики используют компоненты потребительского класса, другие – компоненты, соответствующие требованиям военного стандарта MIL-SPEC. Опытные поставщики обеспечивают функции и дополнительные возможности, востребованные на рынке. Полезно узнать у других системных администраторов, с какими поставщиками они работают, а каких стараются избегать. Оборудование может быть однотипным (от одного поставщика) или разнотипным (от разных поставщиков). Однотипное оборудование проще обслуживать, но разнотипное оборудование позволяет избежать зависимости от одного поставщика и улучшает обслуживание за счет конкуренции между поставщиками. 

3. **Реальные расходы на серверное оборудование** 

Для детального анализа дополнительных расходов на серверы необходимо рассмотреть структуру ценообразования компьютерного оборудования. Большинство поставщиков предлагают три основные категории продукции: для домашнего использования, для бизнеса и серверные решения. Домашние компьютеры, как правило, характеризуются наименьшей начальной ценой, поскольку клиенты принимают решение о покупке на основе рекламируемой стоимости. Дополнительные функции и возможности для расширения в будущем могут быть доступны по более высокой цене. Компьютеры для бизнеса разрабатываются с учётом общей стоимости владения на протяжении всего срока службы. Начальная закупочная цена таких устройств выше, чем у домашних компьютеров, однако они должны сохранять свою актуальность на протяжении более длительного периода. Серверные решения обычно ориентированы на оптимальное соотношение стоимости и производительности. 

Серверы имеют более высокую стоимость по нескольким причинам. Корпус, обеспечивающий удобство обслуживания, может быть более дорогим в производстве из-за конструктивных особенностей. Существуют ограничения на расположение отсеков для дисководов и других панелей, доступ к которым должен быть возможен только с определённой стороны. Тем не менее, более высокая начальная закупочная цена оправдана экономией средств в долгосрочной перспективе благодаря сокращению времени на ремонт (MTTR) и упрощению обслуживания. 

Некорректно сравнивать серверы с настольными компьютерами, поскольку это объекты разных категорий. Понимание этого различия моделей ценообразования помогает в дискуссиях, когда требуется обосновать кажущуюся дороговизну серверного оборудования. Серверы способны обслуживать миллионы транзакций в день или распределять мощность процессора между десятками пользователей, что оправдывает их стоимость. Простой сервера обходится значительно дороже простоя настольного компьютера. Дополнительное оборудование и компоненты с возможностью «горячей» замены на сервере легко окупаются за счёт минимизации остановок в работе. 

Покупка сервера «с запасом» может отсрочить сложную модернизацию для увеличения производительности в будущем, что также имеет ценность. Прогнозирование потребностей и планирование модернизаций помогают избежать излишних затрат и обеспечивают долгосрочную эффективность серверного оборудования. 

**4.1.4 Контракты на обслуживание и запасные компоненты** 

` `Основная идея раздела заключается в том, что при покупке серверов необходимо учитывать планы обслуживания и ремонта оборудования, так как все устройства рано или поздно выходят из строя. Поставщики предлагают различные контракты на обслуживание, и выбор подходящей модели обслуживания зависит от характеристик сети, важности серверов и бюджета компании. Основные моменты: 

1. Типы серверов и обслуживание: 
- Некритичные серверы: 

`  `Контракты с обслуживанием в течение 1-2 дней или только стандартная гарантия могут быть достаточны. 

- Большая группа однотипных серверов: 

`  `Выгодно использовать собственные наборы запасных компонентов и недорогие контракты, покрывающие их замену. 

- Постепенная модернизация: 

`  `Стандартизация запасных комплектов для разных моделей с последующим обновлением по мере замены оборудования. 

2. Подходы к критически важным узлам: 
- В таких случаях ремонт необходим максимально оперативно. Рекомендуется либо держать запас компонентов, либо заключить контракт на обслуживание со сроком реагирования в день поломки. 
- В некоторых случаях контракты включают выделение дублирующей техники. 
  - Компании с большими объемами серверов от одного поставщика: 
- В крупных компаниях возможна организация склада запасных комплектов и привлечение постоянного техника от поставщика для обслуживания сети. Это помогает быстро решать аварийные ситуации, а также снижать расходы через скидки на контракты. 
4. Управление контрактами и инвентаризацией: 
- Регулярный пересмотр контрактов (ежегодно или ежеквартально) для добавления новых и исключения устаревших серверов.- Автоматизация инвентаризации оборудования помогает минимизировать риски забыть добавить серверы в контракт.- Новый сервер может быть включен в контракт сразу при покупке оборудования с условием начала оплаты после 12-месячного гарантийного периода. 
5. Обмен неисправных компонентов: 
- Важна возможность перекрестной доставки, когда поставщик отправляет замену сразу, а неисправные компоненты отправляются после. 
- Некоторые поставщики требуют RMA (номера возврата) и обеспечения оплаты (например, номер кредитной карты) для защиты от невозвратов. 
6. Комплекты запасных компонентов: 

` `-Важны для срочного ремонта. Рекомендуется иметь по одному комплекту запасных деталей для каждой важной модели. 

- Комплекты менее затратны, чем дублирующие системы, и не требуют лицензий на ПО. 
- Дополнительно рекомендуется контракт на обслуживание для обеспечения пополнения использованных запасных частей. 
7. Затраты и компромиссы: 
- Для небольших сетей содержание крупных комплектов запасных частей может быть дорогим. В этом случае целесообразны контракты с быстрым сроком доставки. 
- Комбинация собственных запасов и контрактов на обслуживание позволяет сбалансировать стоимость и оперативность ремонта. 
8. Рекомендации: 
- Выбирать поставщика, предоставляющего перекрестную доставку. 
- Учитывать специфику сети и важность оборудования для выбора типа обслуживания. 
- Рассматривать возможность аутсорсинга для нетехнических компаний (подробности в других главах). 

` `Контракты на обслуживание не предотвращают проблемы, но помогают оперативно их решать благодаря поставке запчастей и ремонту, что особенно важно при необходимости минимизировать простои оборудования. 

Извините, но я не могу предоставить полный текст из-за ограничений авторских прав. Однако я могу сделать краткое резюме. 

5. **Обеспечение целостности данных** 
- Критически важные данные и конфигурации хранятся на серверах и должны быть защищены. 
- Клиентские рабочие станции обычно имеют однотипные конфигурации, и их данные хранятся на серверах, что устраняет необходимость резервного копирования. 
- Windows-платформы не могут избежать локального хранения данных и конфигураций. 
- UNIX-системы менее подвержены этому, так как защищают от записи все, кроме нескольких специфических файлов. 
6. **Размещение серверов в вычислительном центре** 
- Серверы должны устанавливаться в условиях с надежным энергоснабжением, противопожарной защитой, сетью, охлаждением и физической безопасностью. 
- \*\*Резервирование физического места\*\* для сервера при его приобретении. 
- \*\*Установка оборудования\*\* в стойку перед установкой ОС и другого ПО. 
- \*\*Филиалы и компании\*\* должны иметь выделенную комнату или шкаф для физической безопасности, источника бесперебойного питания и охлаждения. 
7. **Конфигурация клиент-серверной ОС** 
- Серверы могут работать под управлением различных ОС, отличных от клиентских. 
- Веб-серверы и клиентские машины должны использовать одинаковый протокол. 
- UNIX-сети с множеством настольных компьютеров и многопроцессорными серверами общего назначения должны иметь одинаковую клонированную ОС. 
- Серверная ОС должна быть ориентирована на перспективу, например, установка всех программных пакетов на Solaris 2.x или минимального набора пакетов на Red Hat Linux. 
8. **Обеспечьте удаленный доступ через консоль** 

**Удаленное обслуживание серверов** является критическим аспектом эффективного управления вычислительными ресурсами. Для оптимизации рабочего пространства и снижения затрат на оборудование используется **переключатель КВМ (KVM)**, позволяющий нескольким серверам совместно использовать одну клавиатуру, монитор и мышь. 

**IP-КВМ** предоставляет возможность удаленного доступа к консольному серверу через сеть, что особенно актуально для удаленных пользователей и служб поддержки. **Последовательные консольные концентраторы**, как самодельные, так и специализированные, служат для обеспечения управления системной консолью в случае сбоев сети. 

**Удаленные консольные системы** позволяют эмулировать сочетания клавиш и записывать данные для последующего анализа, что является важным инструментом для диагностики и устранения проблем. **Сетевые устройства**, оснащенные только последовательными консолями, часто используются для мониторинга и управления сетевыми компонентами. 

**Удаленный доступ** способствует снижению затрат и повышению уровня безопасности, однако требует тщательного подхода к системам аутентификации и конфиденциальности. 

9. **Зеркалирование загрузочных дисков** 

Загрузочный диск труднее всего заменить при повреждении, поэтому для него создается зеркальный диск (RAID 1). Это позволяет автоматически переключаться на работоспособный диск при сбое. Стоимость жестких дисков снизилась, и зеркалирование стало доступнее. В идеале все диски должны быть защищены RAID- схемой, но если это невозможно, зеркалируйте хотя бы загрузочный диск. 

Зеркалирование улучшает производительность чтения, но замедляет запись. Системы с кэшированием при записи, такие как UNIX, менее подвержены этой проблеме. Без зеркального копирования сбой диска приводит к простоям, а с ним — к контролируемым сбоям. Зеркальное копирование защищает от сбоев оборудования, но не от программных или пользовательских ошибок. Ошибки на основном диске копируются на зеркальный, поэтому восстановление состояния невозможно. 

Даже зеркальным дискам требуется резервное копирование. Пример из компании электронной коммерции показал, что программная ошибка может сделать зеркальное копирование бесполезным. Мораль: зеркальное копирование полезно, но важны и утилиты для резервного копирования. 

**4.2 Тонкости** 

1. Повышение надежности и удобства обслуживания 

**Одноцелевые серверы**: Устройства, созданные для выполнения одной задачи, такие как файловые серверы и веб-серверы, более эффективны и надежны, чем универсальные устройства. Они экономят время системных администраторов и предоставляют поддержку от поставщика. 

**Резервные блоки питания**: Важны для обеспечения надежности. Система должна сохранять работоспособность при отказе одного блока питания. Каждый блок питания должен иметь отдельный кабель для предотвращения случайных отключений. 

**Полная избыточность (n + 1)**: Системы, спроектированные для продолжения работы при отказе одного компонента. Примером являются RAID-массивы и коммутаторы Ethernet. Полная избыточность включает два полных набора оборудования, один из которых работает, а второй готов к активации при сбое первого. 

2. **Резервные блоки питания** 

Блоки питания занимают второе место по предрасположенности к сбоям после жестких дисков. Поэтому серверы должны быть оснащены резервными блоками питания. Это означает, что система сохраняет работоспособность при отказе одного блока питания (избыточность n + 1). В некоторых случаях для полной нагрузки требуется два блока питания, а избыточность обеспечивается тремя блоками. Важно выяснить этот вопрос с поставщиками при покупке серверов и сетевого оборудования. 

Каждый блок питания должен иметь отдельный кабель, чтобы избежать случайных отключений. Официальные исследования часто упускают из виду такие проблемы, изучая только энергоснабжение. Отдельные кабели также позволяют подключать устройства к разным источникам питания, избегая простоев. 

Для высокой надежности каждый блок питания должен быть подключен к разным источникам, например, к отдельным UPS. В некоторых вычислительных центрах проводка уже учитывает этот аспект. Чаще всего каждый блок питания подключается к отдельному электрическому распределительному щиту, что позволяет системе продолжать работу при перегрузке одного из щитов. 

3. **Полная избыточность, или n + 1** 

**Избыточность n + 1**: Системы, спроектированные для продолжения работы при отказе одного компонента, такие как RAID-массивы и коммутаторы Ethernet. Полная избыточность включает два полных набора оборудования, один из которых работает, а второй готов к активации при сбое первого. Переключение может быть ручным или автоматическим. 

**Распределение нагрузки**: Обе системы работают и распределяют нагрузку. Если одна система выходит из строя, вторая берет на себя всю нагрузку. Системы могут отслеживать надежность друг друга или использовать внешний источник управления. 

**Экономичность**: Избыточность n + 1 выгоднее при n >= 2. Обычно используется для серверных подсистем. Важно проверять, чтобы поставщик не продавал систему с избыточностью n + 1, где резервными являются только некоторые части системы. 

4. **Компоненты, поддерживающие «горячую» замену** 

**«Горячая» замена**: Возможность отключить и заменить компонент во время работы системы. Это удобно, так как не нужно останавливать систему для устранения проблемы. 

**Преимущества**: 

1. Установка компонентов без отключения системы. 
1. Быстрая замена нерабочих компонентов, что снижает риск двойного сбоя. 

**RAID-системы**:  Включают диск с «горячей» заменой, который активируется при необходимости замены вышедшего из строя диска. Это позволяет системе быстро вернуться в состояние полной избыточности. 

**Стоимость**: Компоненты с «горячей» заменой дороже, но оправданы, если устранение простоев стоит дополнительных затрат. Если система имеет запланированные еженедельные перерывы, такие компоненты могут быть не нужны. 

**Вопросы к поставщикам**: 

1. Какие компоненты не поддерживают «горячую» замену? 
1. Как и на какой период прерывается работа при «горячей» замене? 

**Практика**: Некоторые устройства перезапускают всю систему при замене компонентов, что может занять несколько секунд или минут. Другие системы снижают производительность на время восстановления данных 

5. **Раздельные сети для административных функций** 

` `Дополнительные сетевые интерфейсы на серверах позволяют создать раздельные административные сети. Например, часто создают отдельную сеть для резервного копирования и мониторинга. Резервное копирование требует высокой пропускной способности, и отделение этого трафика от основной сети означает, что резервное копирование не будет мешать пользователям работать с сетью. Подобную отдельную сеть можно спроектировать с помощью довольно простого оборудования, таким образом сделав ее более надежной. Но что самое важное, на эту сеть не будут влиять простои в работе основной сети. Кроме того, она дает системным администраторам возможность получить доступ к машине во время такого простоя. Эта форма избыточности решает очень специфическую проблему. 

2. **Альтернатива: множество недорогих серверов** 

В данной главе исследуется альтернативный подход к использованию серверов, основанный на применении множества недорогих серверов вместо одного дорогостоящего. Основная концепция заключается в том, что при грамотном управлении сбоями несколько серверов с низкой стоимостью могут быть более экономически эффективными. Для обеспечения бесперебойной работы крупной веб- фермы требуется наличие нескольких резервных серверов, настроенных идентично основным. Механизм распределения нагрузки позволяет равномерно распределять запросы между серверами и автоматически обнаруживать и устранять сбои. 

Использование компонентов более низкого качества может привести к экономии средств, компенсируя частые сбои увеличением количества серверов. В 1990-х годах стоимость серверов была высокой, однако массовое производство компонентов для персональных компьютеров способствовало их удешевлению. Компании, такие как Yahoo! и Google, разработали стратегии эффективного управления большим количеством вычислительных ресурсов, что позволило снизить затраты. 

Традиционное представление о том, что коммерческие сервисы не должны запускаться на недорогих серверах, может быть пересмотрено при условии управления значительным количеством таких серверов. Отказ от ненужных компонентов, таких как видеокарты и USB-разъемы, также способствует снижению затрат. Это позволяет приобрести большее количество серверов из серийных компонентов, обеспечивая необходимую вычислительную мощность. 

Масштабные кластерные системы и технология блейд-серверов позволяют размещать значительное количество вычислительных ресурсов на ограниченной площади. Новая технология виртуальных серверов приобретает все большую значимость, поскольку позволяет запускать множество виртуальных серверов на одном мощном сервере, обеспечивая высокий уровень безопасности и упрощая управление. 

**Задания**  

Задания, представленные выше, направлены на анализ текущей инфраструктуры, подходов к обслуживанию и улучшение сетевой устойчивости. Вот комментарии и направления для ответа на них: 

1\. Какие серверы используются в вашем сетевом окружении? 

- Оборудование какого количества поставщиков используется? 
- Анализ преимуществ и недостатков: 
  - Повышение количества поставщиков: 
    - Преимущества: широкий выбор оборудования, возможность подобрать 

оптимальные решения, снижение зависимости от одного поставщика. 

- Недостатки: сложность управления поставкой и контрактами, неоднородность 

оборудования. 

- Уменьшение количества поставщиков: 
  - Преимущества: упрощение поддержки, стандартизация, снижение затрат на 

обучение. 

1. Недостатки: риск зависимости от одного партнёра, ограниченный набор решений. 
2. Стратегия компании при заключении контрактов на обслуживание и ремонт. 
   1. Снижение расходов: 
      1. Проведение регулярного пересмотра контрактов. 
      1. Использование комплектов запасных частей. 
      1. Выделение менее критичных узлов, где можно обходиться без дорогого 

обслуживания. 

- Повышение качества обслуживания: 
  - Заключение контрактов с быстрым временем реакции (до 4 часов) для критически 

важных узлов. 

- Регулярное обучение системных администраторов диагностике и ремонту. 
3. Основные различия между серверами и рабочими станциями: 
- Серверы: 
  - Более высокая производительность, устойчивость к нагрузкам. 
  - Особенности (горячая замена, избыточность n+1). 
  - Поддержка многозадачности и обработки большого количества запросов. 
- Рабочие станции: 
  - Универсальность и гибкость. 
  - Упрощённая замена. 
  - Меньшая зависимость от времени простоя. 
4. Зачем нужна горячая замена без избыточности n+1? 
- Преимущество горячей замены в возможности замены компонентов без отключения 

системы, что минимизирует время простоя и повышает доступность системы. 

5. Как используется избыточность n+1 без горячей замены? 
- Обеспечение отказоустойчивости системы: при выходе из строя одного компонента 

избыточные ресурсы обеспечивают стабильность до планового ремонта. 

6. Критические узлы без избыточности или горячей замены. 
- Провести анализ текущей инфраструктуры, выделить критические узлы. 
- Определить стоимость обновления узлов для добавления поддержки избыточности 

n+1. 

- Рассчитать выгодность обновления (стоимость простоя vs стоимость 

модернизации). 

7. Почему администратор решил подождать профилактического перерыва перед 

добавлением диска? 

- Установка нового оборудования в работающую систему может нести риски: 
  - Возможность сбоя при установке диска. 
  - Потенциальные ошибки конфигурации. 
- Профилактический перерыв даёт возможность провести все работы без нагрузки на 

систему. 

8. Одноцелевые серверы как кандидаты для замены. 
- Службы, которые можно изолировать на одноцелевые серверы: 
  - Базы данных, веб-сервисы, ftp-серверы. 
- Преимущества изоляции: 
  - Уменьшение зависимости служб. 
  - Упрощение диагностики и устранения неполадок.
9. Какие одноцелевые серверы используются?
- Если вы собираетесь заменить одноцелевые серверы универсальными 

машинами: 

- Будет необходим анализ требования рабочих нагрузок.
- Оценка ресурсов универсальной машины для корректного выполнения задач.
- Настройка виртуализации или контейнеризации для изоляции служб.
